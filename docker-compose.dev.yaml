services:
  goals_backend:
    build:
      context: ./backend
      dockerfile: Dockerfile.dev
    user: "${UID:-1000}:${GID:-1000}"
    restart: unless-stopped
    ports:
      - "5059:5059"
    volumes:
      - ./backend/:/usr/src/app
    env_file:
      - .env
    environment:
      HOST_URL: ${HOST_URL:-localhost}
      CARGO_HOME: /tmp/cargo-home
      CARGO_TARGET_DIR: /tmp/cargo-target
      GOOGLE_CLIENT_ID: ${GOOGLE_CLIENT_ID}
      GOOGLE_CLIENT_SECRET: ${GOOGLE_CLIENT_SECRET}
      GOOGLE_REDIRECT_URL: ${GOOGLE_REDIRECT_URL:-http://${HOST_URL:-localhost}:3030/auth/callback}
      VAPID_PUBLIC_KEY: ${VAPID_PUBLIC_KEY}
      VAPID_PRIVATE_KEY: ${VAPID_PRIVATE_KEY}
      VAPID_SUBJECT: ${VAPID_SUBJECT}
      #    db:
      #build:
      #context: ./db
      #dockerfile: Dockerfile.dev
      #ports:
      #- "5432:5432"
      #networks:
      #- dev_network
      #volumes:
      #- goal_db:/var/lib/postgresql/data
      #restart: unless-stopped
  goals_db:
    build:
      context: ./db
      dockerfile: Dockerfile.dev
    ports:
      - "7474:7474"
      - "7687:7687"
    volumes:
      - goal_db:/data

  goals_frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.dev
    volumes:
      - ./frontend:/app
      - /app/node_modules
    environment:
      CHOKIDAR_USEPOLLING: "true" #enable polling
      HOST_URL: ${HOST_URL:-localhost}
      REACT_APP_API_URL: "http://${HOST_URL:-localhost}:5059"
      REACT_APP_GOOGLE_CLIENT_ID: ${GOOGLE_CLIENT_ID}
      REACT_APP_VAPID_PUBLIC_KEY: ${VAPID_PUBLIC_KEY}
    env_file:
      - .env
    ports:
      - "3030:3030"
    restart: unless-stopped

volumes:
  goal_db:
